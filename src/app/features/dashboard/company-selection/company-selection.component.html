<section class="selection-shell">
  <div class="selection-card">
    <header class="selection-card__header">
      <img
        ngSrc="logo.png"
        alt="Logo"
        width="64"
        height="64"
        priority
        class="selection-card__logo"
      />
      <div class="selection-card__heading">
        <span class="selection-card__eyebrow">Sesion activa</span>
        <h1 class="selection-card__title">Selecciona la compania con la que deseas continuar</h1>
        <p class="selection-card__description">
          Esta cuenta tiene varias asociaciones. Elige una opcion para generar un nuevo token y continuar.
        </p>
      </div>
    </header>

    @if (isInitializing()) {
      <div class="selection-skeleton" aria-hidden="true">
        <div class="selection-skeleton__line selection-skeleton__line--title"></div>
        <div class="selection-skeleton__line selection-skeleton__line--subtitle"></div>
        <ul class="selection-skeleton__list">
          @for (_ of skeletonCards; track $index) {
            <li class="selection-skeleton__item">
              <div class="selection-skeleton__line selection-skeleton__line--eyebrow"></div>
              <div class="selection-skeleton__line selection-skeleton__line--name"></div>
              <div class="selection-skeleton__line selection-skeleton__line--meta"></div>
              <div class="selection-skeleton__line selection-skeleton__line--button"></div>
            </li>
          }
        </ul>
      </div>
    } @else {
      @if (error(); as currentError) {
        <div class="selection-alert" role="alert">
          {{ currentError }}
        </div>
      }

      @if (companies().length === 0) {
        <div class="selection-empty">
          <h2 class="selection-empty__title">Sin asociaciones activas</h2>
          <p class="selection-empty__text">
            No encontramos companias vinculadas a esta cuenta. Cierra sesion e inicia nuevamente.
          </p>
          <button type="button" class="selection-empty__button" (click)="logout()">
            Volver al inicio de sesion
          </button>
        </div>
      } @else {
        <ul class="selection-list" role="list" [attr.aria-busy]="isSelecting()">
          @for (company of companies(); track trackCompany($index, company)) {
            <li>
              <button
                type="button"
                class="selection-item"
                [disabled]="isSelecting()"
                [attr.aria-label]="
                  'Seleccionar compania ' +
                  (company.compania.nombre || company.compania.id || 'desconocida')
                "
                (click)="selectCompany(company)"
              >
                <div class="selection-item__header">
                  <span class="selection-item__label">Compania</span>
                  <span class="selection-chip selection-chip--role">
                    Rol: {{ company.rol }}
                  </span>
                </div>
                <h2 class="selection-item__title">
                  {{ company.compania.nombre || company.compania.id }}
                </h2>
                <div class="selection-item__tags">
                  <span class="selection-tag">
                    ID: {{ company.compania.id }}
                  </span>
                  @if (company.oficina) {
                    <span class="selection-tag">
                      Oficina:
                      {{
                        company.oficina.nombre ||
                          company.oficina.id ||
                          'Sin nombre'
                      }}
                    </span>
                  }
                </div>
                <span class="selection-item__cta">
                  {{ isSelecting() ? 'Seleccionando...' : 'Continuar' }}
                </span>
              </button>
            </li>
          }
        </ul>
      }
    }

    <footer class="selection-card__footer">
      <button type="button" class="selection-card__logout" (click)="logout()">
        Cerrar sesion
      </button>
    </footer>
  </div>
</section>
