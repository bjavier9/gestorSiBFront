<ng-container *ngIf="company$ | async as company; else loading">
  <section class="mx-auto max-w-3xl space-y-6">
    <header class="space-y-2">
      <h1 class="text-3xl font-semibold text-slate-900">Create user for {{ company.name }}</h1>
      <p class="text-sm text-slate-500">
        Complete the form below to add a new user to this brokerage. All fields marked as required must be filled in.
      </p>
    </header>

    <article class="rounded-3xl border border-slate-200 bg-white p-8 shadow-sm">
      <form class="space-y-6" [formGroup]="form" (ngSubmit)="submit()">
        <div class="grid gap-6">
          <label class="form-field">
            <span class="form-field__label">First name</span>
            <input type="text" formControlName="firstName" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Last name</span>
            <input type="text" formControlName="lastName" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Email</span>
            <input type="email" formControlName="email" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Role</span>
            <select formControlName="role" class="form-field__input">
              <option value="" disabled>Select role</option>
              <option *ngFor="let role of roles$ | async" [value]="role">{{ role }}</option>
            </select>
          </label>

          <label class="form-field">
            <span class="form-field__label">Document type</span>
            <input type="text" formControlName="documentType" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Document number</span>
            <input type="text" formControlName="documentNumber" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Phone</span>
            <input type="tel" formControlName="phone" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Address</span>
            <input type="text" formControlName="address" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Office</span>
            <select formControlName="officeId" class="form-field__input">
              <option value="">No office</option>
              <option *ngFor="let office of offices$ | async" [value]="office.id">
                {{ office.nombre }}
              </option>
            </select>
          </label>

          <label class="form-field">
            <span class="form-field__label">Temporary password</span>
            <input type="text" formControlName="password" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Birthdate</span>
            <input type="date" formControlName="birthdate" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Gender</span>
            <select formControlName="gender" class="form-field__input">
              <option value="M">Male</option>
              <option value="F">Female</option>
            </select>
          </label>

          <label class="form-field">
            <span class="form-field__label">Civil status</span>
            <input type="text" formControlName="civilStatus" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Profession</span>
            <input type="text" formControlName="profession" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Nationality</span>
            <input type="text" formControlName="nationality" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Children</span>
            <input type="number" formControlName="children" class="form-field__input" />
          </label>

          <label class="form-field">
            <span class="form-field__label">Vehicles</span>
            <input type="number" formControlName="vehicles" class="form-field__input" />
          </label>
        </div>

        <div class="flex flex-wrap items-center justify-between gap-3">
          <a
            [routerLink]="['/admin/companies', company.id, 'users']"
            class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50"
          >
            Back to users
          </a>
          <button
            type="submit"
            [disabled]="isSubmitting()"
            [attr.aria-busy]="isSubmitting()"
            class="inline-flex items-center gap-2 rounded-full bg-sky-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-70"
          >
            Create user
          </button>
        </div>
      </form>

      <p
        *ngIf="feedback() as currentFeedback"
        class="mt-6 text-sm font-medium"
        [ngClass]="{
          'text-emerald-600': currentFeedback.tone === 'success',
          'text-red-600': currentFeedback.tone === 'error'
        }"
      >
        {{ currentFeedback.text }}
      </p>
    </article>
  </section>
</ng-container>

<ng-template #loading>
  <p class="text-sm text-slate-500">Loading company context...</p>
</ng-template>

<ng-template #notFound>
  <article class="company-form-state-card">
    <p class="company-form-state-card__text">Company not found.</p>
    <a
      routerLink="/admin/companies"
      class="inline-flex w-fit items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50"
    >
      Back to companies
    </a>
  </article>
</ng-template>
