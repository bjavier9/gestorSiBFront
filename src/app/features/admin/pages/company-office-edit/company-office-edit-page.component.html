<section class="max-w-2xl space-y-6">
  <ng-container *ngIf="company$ | async as company; else officeEditBreadcrumbFallback">
    <app-admin-breadcrumbs
      [items]="[
        { label: 'Companies', link: ['/admin/companies'] },
        { label: company.name, link: ['/admin/companies', company.id] },
        { label: 'Offices', link: ['/admin/companies', company.id, 'offices'] },
        { label: 'Edit office' }
      ]"
    ></app-admin-breadcrumbs>
  </ng-container>
  <ng-template #officeEditBreadcrumbFallback>
    <app-admin-breadcrumbs
      [items]="[
        { label: 'Companies', link: ['/admin/companies'] },
        { label: 'Offices' },
        { label: 'Edit office' }
      ]"
    ></app-admin-breadcrumbs>
  </ng-template>

  <article class="rounded-3xl border border-slate-200 bg-white p-8 shadow-sm">
    <header class="space-y-2">
      <h1 class="text-2xl font-semibold text-slate-900">Edit office</h1>
      <p class="text-sm text-slate-500">
        <ng-container *ngIf="currentOffice(); else genericOfficeDescription">
          Update the details for {{ currentOffice()?.nombre }}.
        </ng-container>
      </p>
      <ng-template #genericOfficeDescription>
        <span class="text-sm text-slate-500">Update the details for this office.</span>
      </ng-template>
      <p class="text-xs uppercase tracking-wide text-slate-400" *ngIf="company$ | async as company">
        Company {{ company.name }}
      </p>
    </header>

    <ng-container *ngIf="isLoadingOffice(); else editContent">
      <div class="mt-6 space-y-4">
        <div class="h-4 w-1/3 animate-pulse rounded-full bg-slate-200"></div>
        <div class="h-11 w-full animate-pulse rounded-2xl bg-slate-100"></div>
        <div class="h-11 w-full animate-pulse rounded-2xl bg-slate-100"></div>
        <div class="h-11 w-full animate-pulse rounded-2xl bg-slate-100"></div>
      </div>
    </ng-container>

    <ng-template #editContent>
      <ng-container *ngIf="!loadError(); else loadErrorBlock">
        <form class="mt-6 space-y-5" [formGroup]="form" (ngSubmit)="submit()">
          <label class="form-field">
            <span class="form-field__label">Office name</span>
            <input
              type="text"
              formControlName="name"
              autocomplete="organization"
              class="form-field__input"
            />
          </label>

          <label class="form-field">
            <span class="form-field__label">Address</span>
            <input
              type="text"
              formControlName="address"
              autocomplete="street-address"
              class="form-field__input"
            />
          </label>

          <label class="form-field">
            <span class="form-field__label">Phone</span>
            <input
              type="tel"
              formControlName="phone"
              autocomplete="tel"
              class="form-field__input"
            />
          </label>

          <label class="form-field">
            <span class="form-field__label">Currency</span>
            <input
              type="text"
              formControlName="currency"
              autocomplete="off"
              class="form-field__input"
            />
          </label>

          <label class="flex items-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-600">
            <input
              type="checkbox"
              formControlName="active"
              class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
            />
            Office is active
          </label>

          <div class="flex flex-wrap items-center justify-between gap-3">
            <a
              [routerLink]="['/admin/companies', companyId]"
              class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50"
            >
              Back to company overview
            </a>
            <div class="flex flex-wrap gap-3">
              <button
                type="button"
                (click)="resetForm()"
                class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50"
              >
                Reset changes
              </button>
              <button
                type="submit"
                [disabled]="isSubmitting()"
                [attr.aria-busy]="isSubmitting()"
                class="inline-flex items-center gap-2 rounded-full bg-sky-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-70"
              >
                Save changes
              </button>
            </div>
          </div>
        </form>

        <p
          *ngIf="feedback() as currentFeedback"
          class="mt-6 text-sm font-medium"
          [ngClass]="{
            'text-emerald-600': currentFeedback.tone === 'success',
            'text-red-600': currentFeedback.tone === 'error'
          }"
        >
          {{ currentFeedback.text }}
        </p>
      </ng-container>
    </ng-template>

    <ng-template #loadErrorBlock>
      <div class="mt-6 space-y-4">
        <p class="rounded-2xl border border-red-100 bg-red-50 p-4 text-sm font-medium text-red-600">
          {{ loadError() }}
        </p>
        <a
          [routerLink]="['/admin/companies', companyId]"
          class="inline-flex w-fit items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50"
        >
          Back to company overview
        </a>
      </div>
    </ng-template>
  </article>
</section>
